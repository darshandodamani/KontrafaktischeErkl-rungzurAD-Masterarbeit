<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Counterfactual Evaluation</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-6">

    <div class="bg-white shadow-xl rounded-2xl p-6 max-w-4xl w-full">
        <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">ðŸ–¼ Counterfactual Explanation Evaluation</h2>

        <h3 class="text-lg font-semibold text-gray-700">ðŸ”¹ Original Image:</h3>
        <div class="flex flex-col items-center mt-3">
            <img src="{{ url_for('static', filename='images/' + image_data['original']) }}?t={{ timestamp }}" 
                 class="rounded-lg shadow-md w-64 h-auto">
            <p class="text-gray-700 font-medium mt-2">Label: <strong class="text-red-600">{{ image_data['labels']['original'] }}</strong></p>
        </div>

        <h3 class="text-lg font-semibold text-gray-700 mt-6">ðŸ”¹ Select the Best Counterfactual Explanation:</h3>
        <form method="post">
            <input type="hidden" name="image" value="{{ image_data['original'] }}">

            <div class="flex flex-wrap justify-center gap-4 mt-4">
                {% for method, img in image_data.items() if 'method' in method %}
                <label class="cursor-pointer transform transition-transform hover:scale-105">
                    <input type="radio" name="preferred_method" value="{{ method }}" class="hidden peer">
                    <div class="border-2 border-gray-300 peer-checked:border-blue-500 p-2 rounded-lg shadow-md text-center">
                        <img src="{{ url_for('static', filename='images/' + img) }}?t={{ timestamp }}" 
                             class="rounded-md w-60 h-auto">
                        <p class="text-gray-700 font-medium mt-2">Label: <strong class="text-green-600">{{ image_data['labels'][method] }}</strong></p>
                    </div>
                </label>
                {% endfor %}
            </div>

            <h3 class="text-lg font-semibold text-gray-700 mt-6">ðŸ”¹ Rate Each Counterfactual:</h3>
            <p class="text-gray-600 text-md">Compare the counterfactual images and rate them based on these key factors.</p>

            <div class="space-y-4 mt-3">
                {% set rating_criteria = {
                    'interpretability': {
                        'question': 'Does the change make sense?',
                        'description': 'Imagine you see a traffic light turning from red to green. Would it make sense if the AI changed its decision from "STOP" to "GO"? The explanation should be clear and easy to understand.',
                        'color': 'blue'
                    },
                    'plausibility': {
                        'question': 'Does the counterfactual look real?',
                        'description': 'If something in the image changes, does it still look like a natural photo? Example: If a STOP sign is removed, does the background look smooth and natural, or does it look fake and edited?',
                        'color': 'green'
                    },
                    'actionability': {
                        'question': 'Can this information be used to make a real-world decision?',
                        'description': 'If the AI suggests a change, could a real person actually make that change? Example: If removing snow from a road makes the AI recognize it as safe to drive, thatâ€™s an actionable insight!',
                        'color': 'yellow'
                    },
                    'trust_ai': {
                        'question': 'Does this explanation make you trust the AI more?',
                        'description': 'If the explanation is clear and logical, does it make you feel confident that the AI is making fair and accurate decisions? A good explanation helps people trust AI decisions instead of feeling confused or skeptical.',
                        'color': 'purple'
                    },
                    'visual_coherence': {
                        'question': 'Are only the necessary parts changed?',
                        'description': 'If the AI changes a small detail in the image, does the rest of the picture stay the same? Example: If the AI needs to change a STOP sign to a GO sign, it should only modify the sign and not the entire image randomly.',
                        'color': 'pink'
                    }
                } %}

                {% for criterion, details in rating_criteria.items() %}
                <div class="bg-{{ details.color }}-50 p-4 rounded-xl shadow-md">
                    <label class="block text-{{ details.color }}-700 font-semibold">{{ criterion }}:</label>
                    <p class="text-sm text-gray-600 italic mb-2">{{ details.question }}</p>
                    <p class="text-sm text-gray-700">{{ details.description }}</p>
                    <div class="flex justify-between mt-2">
                        {% for i in range(1, 6) %}
                        <label class="cursor-pointer">
                            <input type="radio" name="{{ criterion | lower | replace(' ', '_') }}" value="{{ i }}" class="hidden peer">
                            <span class="w-10 h-10 flex items-center justify-center rounded-full text-gray-600 font-bold
                                         border-2 border-gray-300 peer-checked:bg-{{ details.color }}-500 peer-checked:text-white peer-checked:border-{{ details.color }}-500">
                                {{ i }}
                            </span>
                        </label>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>

            <h3 class="text-lg font-semibold text-gray-700 mt-6">ðŸ”¹ Additional Comments (Optional):</h3>                    
            <textarea name="comments" placeholder="Write any additional feedback..." 
                        class="w-full p-3 mt-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>


            <button type="submit" 
                    class="w-full mt-6 py-3 bg-blue-600 text-white font-semibold rounded-xl shadow-md
                           hover:bg-blue-700 transition-all transform hover:scale-105">
                Submit
            </button>
        </form>
    </div>

</body>
</html>
